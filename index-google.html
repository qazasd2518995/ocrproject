<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>源正山鋼索五金行 - Google Vision OCR 辨識系統</title>
    <link rel="stylesheet" href="css/style-v2.css">
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>源正山鋼索五金行</h1>
            <h2>🚀 Google Vision 智能帳單辨識系統</h2>
            <p class="subtitle">整合 Google Cloud Vision API - 業界最強 OCR 技術</p>
        </header>

        <!-- API 狀態 -->
        <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin: 0 0 10px 0; color: #2e7d32;">✅ API 已設定</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <div>📍 Google Vision API: 已啟用</div>
                <div>📍 OCR.space API: 已啟用</div>
                <div>📍 每月免費額度: 1000 次</div>
            </div>
        </div>

        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                <p class="upload-text">拖放檔案到此處或點擊選擇</p>
                <p class="upload-hint">支援 JPG、PNG、PDF 格式</p>
                <input type="file" id="fileInput" accept="image/*,.pdf,.heic" hidden>
            </div>
        </div>

        <!-- 整體進度 -->
        <div class="overall-progress" id="overallProgress" style="display: none;">
            <h3>正在處理...</h3>
            <div class="progress-container">
                <div class="engine-progress">
                    <span class="engine-name">Tesseract 標準版</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress1"></div>
                    </div>
                    <span class="status" id="status1">等待中...</span>
                </div>
                <div class="engine-progress">
                    <span class="engine-name">Tesseract 增強版</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress2"></div>
                    </div>
                    <span class="status" id="status2">等待中...</span>
                </div>
                <div class="engine-progress">
                    <span class="engine-name">OCR.space API</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress3"></div>
                    </div>
                    <span class="status" id="status3">等待中...</span>
                </div>
                <div class="engine-progress">
                    <span class="engine-name">🌟 Google Cloud Vision</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress4" style="background: linear-gradient(90deg, #4285f4, #34a853);"></div>
                    </div>
                    <span class="status" id="status4">等待中...</span>
                </div>
                <div class="engine-progress">
                    <span class="engine-name">🧠 AI 智能融合</span>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress5"></div>
                    </div>
                    <span class="status" id="status5">等待中...</span>
                </div>
            </div>
        </div>

        <!-- 原始圖片預覽 -->
        <div class="preview-section" id="previewSection" style="display: none;">
            <h3>原始圖片</h3>
            <div class="preview-container">
                <img id="previewImage" alt="預覽圖片">
                <canvas id="pdfCanvas" style="display: none;"></canvas>
            </div>
        </div>

        <!-- 多引擎結果顯示 -->
        <div class="results-container" id="resultsContainer" style="display: none;">
            <h3>辨識結果比較</h3>
            
            <!-- 快速操作按鈕 -->
            <div class="quick-actions">
                <button class="btn btn-primary" onclick="showBestResult()">顯示最佳結果</button>
                <button class="btn btn-secondary" onclick="compareResults()">比較差異</button>
                <button class="btn btn-info" onclick="mergeResults()">合併結果</button>
            </div>

            <!-- 標籤式結果顯示 -->
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('tab1')">Tesseract 標準</button>
                <button class="tab-btn" onclick="showTab('tab2')">Tesseract 增強</button>
                <button class="tab-btn" onclick="showTab('tab3')">OCR.space</button>
                <button class="tab-btn" onclick="showTab('tab4')" style="background: linear-gradient(135deg, #4285f415, #34a85315);">
                    🌟 Google Vision
                </button>
                <button class="tab-btn" onclick="showTab('tab5')" style="background: linear-gradient(135deg, #667eea15, #764ba215);">
                    🧠 AI 融合
                </button>
            </div>

            <!-- 各引擎結果 -->
            <div class="tab-content" id="tab1">
                <div class="result-header">
                    <h4>Tesseract 標準版</h4>
                    <div class="result-stats">
                        <span class="confidence" id="confidence1">信心度: --</span>
                        <span class="time" id="time1">處理時間: --</span>
                    </div>
                </div>
                <div class="result-actions">
                    <button class="btn-small" onclick="selectText('result1')">全選</button>
                    <button class="btn-small" onclick="copyText('result1')">複製</button>
                    <button class="btn-small" onclick="downloadText('result1', 'tesseract-standard')">下載</button>
                </div>
                <div class="result-text" id="result1" contenteditable="true" spellcheck="false">
                    等待辨識...
                </div>
            </div>

            <div class="tab-content" id="tab2" style="display: none;">
                <div class="result-header">
                    <h4>Tesseract 增強版</h4>
                    <div class="result-stats">
                        <span class="confidence" id="confidence2">信心度: --</span>
                        <span class="time" id="time2">處理時間: --</span>
                    </div>
                </div>
                <div class="result-actions">
                    <button class="btn-small" onclick="selectText('result2')">全選</button>
                    <button class="btn-small" onclick="copyText('result2')">複製</button>
                    <button class="btn-small" onclick="downloadText('result2', 'tesseract-enhanced')">下載</button>
                </div>
                <div class="result-text" id="result2" contenteditable="true" spellcheck="false">
                    等待辨識...
                </div>
            </div>

            <div class="tab-content" id="tab3" style="display: none;">
                <div class="result-header">
                    <h4>OCR.space API</h4>
                    <div class="result-stats">
                        <span class="confidence" id="confidence3">信心度: --</span>
                        <span class="time" id="time3">處理時間: --</span>
                    </div>
                </div>
                <div class="result-actions">
                    <button class="btn-small" onclick="selectText('result3')">全選</button>
                    <button class="btn-small" onclick="copyText('result3')">複製</button>
                    <button class="btn-small" onclick="downloadText('result3', 'ocr-space')">下載</button>
                </div>
                <div class="result-text" id="result3" contenteditable="true" spellcheck="false">
                    等待辨識...
                </div>
            </div>

            <div class="tab-content" id="tab4" style="display: none;">
                <div class="result-header">
                    <h4>🌟 Google Cloud Vision API</h4>
                    <div class="result-stats">
                        <span class="confidence" id="confidence4">信心度: --</span>
                        <span class="time" id="time4">處理時間: --</span>
                    </div>
                </div>
                <div style="background: #e8f5e9; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                    <p style="margin: 0; color: #2e7d32;">✨ Google 最先進的 AI 視覺技術，支援繁體中文、表格、手寫體</p>
                </div>
                <div class="result-actions">
                    <button class="btn-small" onclick="selectText('result4')">全選</button>
                    <button class="btn-small" onclick="copyText('result4')">複製</button>
                    <button class="btn-small" onclick="downloadText('result4', 'google-vision')">下載</button>
                </div>
                <div class="result-text" id="result4" contenteditable="true" spellcheck="false">
                    等待辨識...
                </div>
            </div>

            <div class="tab-content" id="tab5" style="display: none;">
                <div class="result-header">
                    <h4>🧠 AI 智能融合結果</h4>
                    <div class="result-stats">
                        <span class="confidence" id="confidence5">信心度: --</span>
                        <span class="time" id="time5">處理時間: --</span>
                    </div>
                </div>
                <div class="ai-info">
                    <p>🤖 AI 分析了所有引擎的結果（特別是 Google Vision），智能選擇最準確的文字</p>
                </div>
                <div class="result-actions">
                    <button class="btn-small" onclick="selectText('result5')">全選</button>
                    <button class="btn-small" onclick="copyText('result5')">複製</button>
                    <button class="btn-small" onclick="downloadText('result5', 'ai-fusion')">下載</button>
                </div>
                <div class="result-text" id="result5" contenteditable="true" spellcheck="false">
                    等待辨識...
                </div>
            </div>
        </div>

        <!-- 重新上傳按鈕 -->
        <button class="btn btn-reset" id="resetBtn" style="display: none;" onclick="resetAll()">
            重新上傳
        </button>
    </div>

    <!-- Toast 通知 -->
    <div class="toast" id="toast"></div>

    <script src="js/google-vision-ocr.js"></script>
</body>
</html>