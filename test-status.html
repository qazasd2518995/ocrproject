<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>API ç‹€æ…‹æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .status-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .status-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>OCR.space API ç‹€æ…‹æ¸¬è©¦</h1>
    <p>API Key: K87802744288957</p>
    
    <div class="status-box">
        <h3>æœ¬åœ°å„²å­˜çš„ä½¿ç”¨æ•¸æ“šï¼š</h3>
        <div id="localData"></div>
    </div>
    
    <button onclick="testUsage()">æ¨¡æ“¬å¢åŠ ä½¿ç”¨æ¬¡æ•¸</button>
    <button onclick="clearData()">æ¸…é™¤æœ¬åœ°æ•¸æ“š</button>
    <button onclick="checkStatus()">æª¢æŸ¥ API ç‹€æ…‹</button>
    
    <div class="status-box">
        <h3>æ¸¬è©¦çµæœï¼š</h3>
        <div id="result"></div>
    </div>

    <script>
        // API ç‹€æ…‹ç®¡ç†é¡åˆ¥ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        class TestAPIStatus {
            constructor() {
                this.apiKey = 'K87802744288957';
                this.maxMonthlyLimit = 25000;
                this.loadData();
            }
            
            loadData() {
                const saved = localStorage.getItem('ocrApiUsage');
                if (saved) {
                    this.data = JSON.parse(saved);
                } else {
                    this.data = {
                        today: 0,
                        month: 0,
                        remaining: 25000,
                        lastChecked: new Date().toISOString()
                    };
                }
                this.display();
            }
            
            saveData() {
                this.data.lastChecked = new Date().toISOString();
                localStorage.setItem('ocrApiUsage', JSON.stringify(this.data));
                this.display();
            }
            
            increment() {
                this.data.today++;
                this.data.month++;
                this.data.remaining = Math.max(0, this.maxMonthlyLimit - this.data.month);
                this.saveData();
            }
            
            display() {
                document.getElementById('localData').innerHTML = `
                    <div class="status-item">ä»Šæ—¥ä½¿ç”¨ï¼š${this.data.today} æ¬¡</div>
                    <div class="status-item">æœ¬æœˆä½¿ç”¨ï¼š${this.data.month} æ¬¡</div>
                    <div class="status-item">å‰©é¤˜é¡åº¦ï¼š${this.data.remaining} æ¬¡</div>
                    <div class="status-item">ä¸Šæ¬¡æ›´æ–°ï¼š${new Date(this.data.lastChecked).toLocaleString('zh-TW')}</div>
                    <div class="status-item">ä½¿ç”¨ç‡ï¼š${((this.data.month / this.maxMonthlyLimit) * 100).toFixed(2)}%</div>
                `;
            }
        }
        
        const manager = new TestAPIStatus();
        
        function testUsage() {
            manager.increment();
            document.getElementById('result').innerHTML = '<p style="color: green;">âœ… å·²å¢åŠ ä¸€æ¬¡ä½¿ç”¨è¨˜éŒ„</p>';
        }
        
        function clearData() {
            localStorage.removeItem('ocrApiUsage');
            manager.loadData();
            document.getElementById('result').innerHTML = '<p style="color: blue;">ğŸ”„ å·²æ¸…é™¤æœ¬åœ°æ•¸æ“š</p>';
        }
        
        async function checkStatus() {
            document.getElementById('result').innerHTML = '<p>æª¢æŸ¥ä¸­...</p>';
            
            try {
                // æ¸¬è©¦å°åœ–ç‰‡
                const testImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
                
                const base64Data = testImage.split(',')[1];
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], {type: 'image/png'});
                
                const formData = new FormData();
                formData.append('file', blob, 'test.png');
                formData.append('apikey', manager.apiKey);
                formData.append('language', 'eng');
                
                const response = await fetch('https://api.ocr.space/parse/image', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok && !result.IsErroredOnProcessing) {
                    document.getElementById('result').innerHTML = `
                        <p style="color: green;">âœ… API é€£æ¥æˆåŠŸ</p>
                        <p>è™•ç†æ™‚é–“ï¼š${result.ProcessingTimeInMilliseconds}ms</p>
                    `;
                    manager.increment(); // æ¸¬è©¦ä¹Ÿç®—ä¸€æ¬¡ä½¿ç”¨
                } else {
                    document.getElementById('result').innerHTML = `
                        <p style="color: red;">âŒ API éŒ¯èª¤</p>
                        <p>${result.ErrorMessage || 'æœªçŸ¥éŒ¯èª¤'}</p>
                    `;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <p style="color: red;">âŒ é€£æ¥å¤±æ•—</p>
                    <p>${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>